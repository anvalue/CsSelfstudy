[toc]

> 难点：使用程序模拟IIC总线协议
>
> 重点：理论知识-80%以上理论知识都需要记住

# 串行通信中的IIC总线工作原理和协议

> `常用总线协议`：UART、1-wire、IIC和SPI总线
>
> UART：`异步通信`（一条数据输入线、一条数据输出线）
>
> 1-wire：单线总线，又叫`单总线`（只有一条线）
>
> IIC：同步串行`2线`方式通信（一条时钟线，一条数据线）
>
> SPI：同步串行`3线`方式进行通信（一条时钟线，一条数据输入线，一条数据输出线）

## IIC 总线组成及工作原理

两根双向信号线，一根`数据线`SDA(serial data I/O),一根`时钟线`SCL（serial clock）

![](https://gitee.com/constsheng/imgcurl/raw/master/img/20210519194039.png)



1. 多主机系统中，可能同时有几个主机企图启动总线传送数据。为避免混乱，IIC总线要通过总线仲裁，以决定由哪一台主机控制总线（*以80c51单片机应用系统的串行总线扩展中，我们经常遇到的是以80c51单片机为主机，其他接口器件为从机的单主机情况*）

2.  IIC总线通过上拉电阻接正电源

3. 当总线空闲时，两根线均为高电平。连到总线上的任一器件输出的低电平，都将使总线的信号变低，即各器件的SDA及SCL都是线“与”关系。

4. IIC总线传输协议

   - 数据位的有效性规定：
     - SCL信号为高电平期间，数据线上的数据必须保持稳定
     - SCL信号为低电平期间，SDA状态才允许变化
     - ![](https://gitee.com/constsheng/imgcurl/raw/master/img/20210520155329.png)

5. IIC的起始和终止信号

   - SCL线为高电平期间，SDA线由高电平向低电平的变化表示`起始信号`
   - SCL线为高电平期间，SDA线由低电平向高电平的变化表示`终止信号`
     - 起始和终止信号都是由主机发出的，在起始信号产生后，总线就处于被占用的状态；
     - 终止信号产生后，总线就处于空闲状态

6. IIC字节的传送与应答：

   - > 每一个字节必须保证是8位长度。数据传送时，先传送最高位(MSB)，每一个被传送的字节后面都必须跟随一位应答位（即一帧共有9位）
     >
     > ![](https://gitee.com/constsheng/imgcurl/raw/master/img/20210520160221.png)

7. 数据帧格式：IIC总线上传送的数据信号是广义的，既包含地址信号，又包括真正的数据信号。

   - > - 在起始信号后必须传送一个从机的地址（7位），第8位是数据的传送方向为（R/T）
     >
     > - 用“0”表示主机发送数据（T）
     >
     > - 用“1”表示主机接收数据（R）
     > - 每次数据传送总是由主机产生的终止信号结束。
     > - 但是，若主机希望继续占用总线进行新的数据传送，则可以不产生终止信号，马上再次发出起始信号对另一从机进行寻址

8. 在总线的一次数据传送过程中，可以有以下几种组合方式：

   1. `主机`向从机`发送`数据，数据传送方向在整个传送过程中不变

      ![](https://gitee.com/constsheng/imgcurl/raw/master/img/20210520161915.png)

   2. 主机在第一个字节后，立即从从机读数据

      ![](https://gitee.com/constsheng/imgcurl/raw/master/img/20210520162107.png)

   3. 传送过程中，当需要改变传送方向时，起始信号和从机地址都被重复产生一次，但两次读/写方向位正好反相

      ![](https://gitee.com/constsheng/imgcurl/raw/master/img/20210520162612.png)

9. 总线的寻址：IIC总线协议有明确的规定：采用7位的寻址字节（寻址字节是起始信号后的第一个字节）

   1. 寻址字节的位定义

      ![](https://gitee.com/constsheng/imgcurl/raw/master/img/20210520162757.png)

   2. ![](https://gitee.com/constsheng/imgcurl/raw/master/img/20210520162935.png)

      

# 原理图分析



# 实践编程

